// ==UserScript==
// @name            Resize YT To Window Size
// @description     Moves the YouTube video to the top of the website and fill the window with the video player.
// @author          Chris H (Zren / Shade)
// @license         MIT
// @icon            https://s.ytimg.com/yts/img/favicon_32-vflOogEID.png
// @homepageURL     https://github.com/Zren/ResizeYoutubePlayerToWindowSize/
// @namespace       http://xshade.ca
// @version         139
// @include         http*://*.youtube.com/*
// @include         http*://youtube.com/*
// @include         http*://*.youtu.be/*
// @include         http*://youtu.be/*
// @grant           none
// ==/UserScript==
!function(e){"use strict";var t="100vh",a=e;if(!a.ytwp&&!function(){try{return e.self!==e.top}catch(e){return!0}}()){var n=function(e){this.id=e,this.stylesheet=""};n.prototype.buildRule=function(e,t){var a="";for(var n in t)a+="\t"+n+": "+t[n]+";\n";return e+" {\n"+a+"}\n"},n.prototype.appendRule=function(e,t,a){var n;if(e instanceof Array&&(e=e.join(",\n")),g(t)||g(a)||!function(e){return"string"==typeof e}(t)){if(g(t)||!g(a)||!function(e){return"object"==typeof e}(t))return void console.log("Illegal arguments",arguments);n=this.buildRule(e,t)}else{var i={};i[t]=a,n=this.buildRule(e,i)}this.stylesheet+=n},n.injectIntoHeader=function(e,t){var a=document.getElementById(e);a||((a=document.createElement("style")).type="text/css",a.id=e,document.getElementsByTagName("head")[0].appendChild(a)),a.appendChild(document.createTextNode(t))},n.prototype.injectIntoHeader=function(){n.injectIntoHeader(this.id,this.stylesheet)};var i=function(){};i.listeners=[],i.dispatch=function(e,t,a){for(var n=this.listeners,i=0,o=n.length;i<o;i++)n[i].call(this,e,t,a)},i.onPushState=function(t,a,n){return i.dispatch(t,a,n),i.origPushState.apply(e.history,arguments)},i.onReplaceState=function(t,a,n){return i.dispatch(t,a,n),i.origReplaceState.apply(e.history,arguments)},i.inject=function(){i.injected||(i.origPushState=e.history.pushState,i.origReplaceState=e.history.replaceState,e.history.pushState=i.onPushState,e.history.replaceState=i.onReplaceState,i.injected=!0)},i.timerId=0,i.onTick=function(){var t=e.location.pathname+e.location.search;i.lastPage!=t&&(i.dispatch({},document.title,e.location.href),i.lastPage=t)},i.startTimer=function(){i.lastPage=e.location.pathname+e.location.search,i.timerId=setInterval(i.onTick,500)},i.stopTimer=function(){clearInterval(i.timerId)},e.ytwpHistoryEvent=i;var o="ytwp",r=o+"-style",l=o+"-window-player",p=o+"-viewing-video",d=o+"-scrolltop",s='html:not([fullscreen="true"])',y="body."+l,c=s+" "+(y+=":not(.enhancer-for-youtube-pinned-player)"),u=["transition","-ms-transition","-moz-transition","-webkit-transition","-o-transition"],h=["transform","-ms-transform","-moz-transform","-webkit-transform","-o-transform"],m=a.ytwp={scriptShortName:o,log_:function(e,t){return e.apply(console,["["+this.scriptShortName+"] "].concat(Array.prototype.slice.call(t))),1},log:function(){return this.log_(console.log,arguments)},error:function(){return this.log_(console.error,arguments)},initialized:!1,pageReady:!1,isWatchPage:!1};m.debugPage=function(){for(var e,t={display:"block",position:"static",left:"auto",right:"auto",top:"auto",bottom:"auto","padding-left":"0px","padding-right":"0px","padding-top":"0px","padding-bottom":"0px","margin-left":"0px","margin-right":"0px","margin-top":"0px","margin-bottom":"0px",width:"auto","min-width":"auto","max-width":"auto",height:"auto","min-height":"auto","max-height":"auto"},a=Object.keys(t),n=document.querySelector("#movie_player video"),i="";n&&n.parentNode;){var o=getComputedStyle(n),r={};for(var l of o)a.includes(l)&&o[l]!=t[l]&&(r[l]=o[l]);i+=(e=void 0,(e=n.outerHTML).substr(0,e.indexOf(">")+1)+" "+JSON.stringify(r)+"\n"),n=n.parentNode}i=i.split("\n").reverse().join("\n"),m.log("debugPage",i)},m.hasYoutubeChanged=function(){var e=["html","body","ytd-app","#content.ytd-app","ytd-page-manager#page-manager.ytd-app","ytd-watch-flexy.ytd-page-manager","#full-bleed-container.ytd-watch-flexy","#player-full-bleed-container.ytd-watch-flexy","#player-container.ytd-watch-flexy","ytd-player#ytd-player.ytd-watch-flexy","#container.ytd-player",".html5-video-player",".html5-video-container","video.html5-main-video"];e=e.reverse();var t=document.querySelector(e[0]);if(!t)return m.error("YT has changed!",e[0],"no longer exists!"),!0;for(var a=1;a<e.length;a++){var n=t.parentNode,i=e[a];n.matches(i)?t=n:m.error("YT has changed!",i,"no longer exists!")}return!1},m.isWatchUrl=function(e){return e||(e=a.location.href),e.match(/https?:\/\/(www\.)?youtube.com\/(c|channel|user)\/[^\/]+\/live/)?!document.querySelector("ytd-browse"):e.match(/https?:\/\/(www\.)?youtube.com\/watch\?/)},m.setTheaterMode=function(e){var t=document.querySelector("ytd-watch:not([hidden])")||document.querySelector("ytd-watch-flexy:not([hidden])")||document.querySelector("ytd-watch-grid:not([hidden])");if(t){if(e!=t.hasAttribute("theater")){if(!(a=document.querySelector(t.tagName+":not([hidden]) button.ytp-size-button")))a=document.querySelectorAll(t.tagName+":not([hidden]) button.ytp-screen-mode-settings-button")[1];a&&a.click()}t.canFitTheater_=!0}else if(t=document.querySelector("#page.watch")){var a;if(e!=t.classList.contains("watch-stage-mode"))(a=t.querySelector("button.ytp-size-button"))&&a.click()}},m.enterTheaterMode=function(){document.body.classList.contains(l)&&m.setTheaterMode(!0)},m.enterTheaterMode(),a.addEventListener("resize",m.enterTheaterMode),m.detectPlayerUnavailable=function(){document.querySelector("[player-unavailable]")&&m.event.removeBodyClass()},m.init=function(){m.log("init"),m.initialized||(m.isWatchPage=m.isWatchUrl(),m.isWatchPage&&(m.removeSearchAutofocus(),document.getElementById(r)||m.event.initStyle(),m.initScroller(),m.initialized=!0,m.pageReady=!1)),m.event.onWatchInit(),m.isWatchPage&&m.html5PlayerFix()},m.initScroller=function(){a.addEventListener("scroll",m.onScroll,!1),a.addEventListener("resize",m.onScroll,!1),m.onScroll()},m.onScroll=function(){var e=document.documentElement.clientHeight;m.isWatchPage&&0==a.scrollY?document.body.classList.add(d):document.body.classList.remove(d),m.isWatchPage&&a.scrollY<=e?document.body.classList.add(p):document.body.classList.remove(p)},m.event={initStyle:function(){if(m.log("initStyle"),m.style=new n(r),m.event.buildStylesheet(),a.spf){c=s+" "+(y='body[data-spf-name="watch"]'),m.event.buildStylesheet(),m.style.appendRule('body[data-spf-name="watch"]:not(.ytwp-window-player) #masthead-positioner',{position:"absolute",top:t+" !important"})}m.style.injectIntoHeader()},buildStylesheet:function(){var e;m.log("buildStylesheet"),m.style.appendRule(y+"::-webkit-scrollbar",{width:"0 !important",height:"0 !important"}),m.style.appendRule("html",{"scrollbar-width":"none"}),(e=f(u,"left 0s linear, padding-left 0s linear")).padding="0 !important",e.margin="0 !important",m.style.appendRule([y+" #player",y+".ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible #player",y+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #player",y+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #player-legacy",y+".ltr.ytcenter-site-center.ytcenter-non-resize.ytcenter-guide-visible.guide-collapsed #watch7-main-container"],e),(e=f(u,"width 0s linear, left 0s linear")).float="initial",e.left=0,e["margin-left"]=0,m.style.appendRule(y+" #player-api",e),m.style.appendRule(y+" .watch-stage-mode #player .player-api",{left:"initial !important","margin-left":"initial !important"}),m.style.appendRule([c+" #player",c+" #player-wrap",c+" #player-api",s+":not(.floater):not(.iri-always-visible) "+y+" #movie_player",c+" #player-mole-container",s+":not(.floater):not(.iri-always-visible) "+y+" .html5-video-container",s+":not(.floater):not(.iri-always-visible) "+y+" .html5-main-video",c+" ytd-watch-flexy[theater] #player-theater-container.ytd-watch-flexy",c+" ytd-watch-flexy[flexy] #player-container-outer.ytd-watch-flexy",c+" ytd-watch-flexy[flexy] #player-container-inner.ytd-watch-flexy",c+" ytd-watch-flexy[flexy] #player-container.ytd-watch-flexy",c+" ytd-watch-grid[theater] #player-theater-container.ytd-watch-grid",c+" ytd-watch-grid[flexy] #player-container-outer.ytd-watch-grid",c+" ytd-watch-grid[flexy] #player-container-inner.ytd-watch-grid",c+" ytd-watch-grid[flexy] #player-container.ytd-watch-grid"],{width:"100% !important","min-width":"100% !important","max-width":"100% !important",height:t+" !important","min-height":t+" !important","max-height":t+" !important"}),m.style.appendRule([c+" #player",c+" .html5-main-video"],{top:"0 !important",right:"0 !important",bottom:"0 !important",left:"0 !important"}),m.style.appendRule(c+" #player .player-width","width","100% !important"),m.style.appendRule(c+" #player .player-height","height","100% !important"),m.style.appendRule([c+" .html5-video-player .ad-container-single-media-element-annotations",c+" .html5-video-player .ytp-upnext"],"top","0"),m.style.appendRule(c+" .ytp-fit-cover-video .html5-main-video","object-fit","contain !important"),m.style.appendRule(c+" .ytp-cued-thumbnail-overlay-image",{"background-size":"contain !important","-moz-background-size":"contain !important","-webkit-background-size":"contain !important"}),m.style.appendRule(c+" #movie_player","background-color","#000000"),m.style.appendRule(c+" #player",{position:"absolute"}),m.style.appendRule(c,{"margin-top":t}),m.style.appendRule(c+" button.ytp-button.ytp-cards-button","top","0"),(e=f(u,"margin-top 0s linear, padding-top 0s linear"))["margin-top"]="0 !important",e.top="0 !important",m.style.appendRule(c+" #watch7-sidebar",e),m.style.appendRule(c+".cardified-page #watch7-sidebar-contents","padding-top","0"),m.style.appendRule("#skip-navigation.ytd-masthead","top","-150vh"),e=f(u,"top 0s linear !important"),m.style.appendRule(c+".hide-header-transition #masthead-positioner",e),m.style.appendRule(c+"."+p+" #masthead-positioner",{position:"absolute",top:t+" !important"}),m.style.appendRule("html.floater "+y+"."+p+" #masthead-positioner",{"z-index":"5"}),m.style.appendRule(c+" .sbdd_a",{top:"56px"}),m.style.appendRule(c+"."+p+" .sbdd_a",{top:"calc(100vh + 56px) !important",position:"absolute !important"}),m.style.appendRule(c+"."+p+" #appbar-guide-menu",{display:"initial",position:"absolute",top:"100% !important"}),m.style.appendRule(c+"."+p+" #page.watch #guide",{display:"initial",margin:"0",position:"initial"}),m.style.appendRule(c+".lock-scrollbar",{top:"0 !important",position:"static !important"}),m.style.appendRule(c+" #miniplayer-bar #player",{position:"static"}),m.style.appendRule([c+" #miniplayer-bar #player",c+" #miniplayer-bar #player-api",s+":not(.floater):not(.iri-always-visible) "+y+" #miniplayer-bar #movie_player",c+" #player-mole-container",s+":not(.floater):not(.iri-always-visible) "+y+" #miniplayer-bar .html5-video-container",s+":not(.floater):not(.iri-always-visible) "+y+" #miniplayer-bar .html5-main-video"],{width:"252px !important","min-width":"252px !important","max-width":"252px !important",height:"142px !important","min-height":"142px !important","max-height":"142px !important"}),m.style.appendRule(".video-stream.html5-main-video",{top:"0 !important"}),m.style.appendRule(c+"."+d,"overflow-x","hidden"),m.style.appendRule(c+" #placeholder-player","display","none"),m.style.appendRule(c+" #watch-sidebar-spacer","display","none"),m.style.appendRule(c+" .skip-nav","display","none"),m.style.appendRule(c+" #page.watch","padding-top","0"),m.style.appendRule(c+" .player-branded-banner","height","0"),m.style.appendRule(c+" #body-container","position","static"),m.style.appendRule(s+".part_static_size:not(.content-snap-width-skinny-mode) "+y+" .watch-non-stage-mode #player-playlist","width","1066px"),m.style.appendRule([c+" #placeholder-playlist",c+" #player .player-height#watch-appbar-playlist"],{height:"540px !important","max-height":"540px !important"}),e=f(u,"transform 0s linear"),m.style.appendRule(c+" #watch-appbar-playlist",e),(e=f(h,"translateY(0px)"))["margin-left"]="0",e.top="calc(100vh + 60px)",m.style.appendRule(c+" #player .player-height#watch-appbar-playlist",e),m.style.appendRule(c+" .playlist-videos-list",{"max-height":"470px !important",height:"initial !important"}),m.style.appendRule(c+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1066px)/2 + 640px + 10px)",width:"416px"}),m.style.stylesheet+="@media screen and (min-height: 630px) and (min-width: 1294px) {\n",m.style.appendRule(c+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1280px)/2 + 854px + 10px)"}),m.style.stylesheet+="}\n @media screen and (min-width: 1720px) and (min-height:980px) {\n",m.style.appendRule(c+" #player .player-height#watch-appbar-playlist",{left:"calc((100vw - 1706px)/2 + 1280px + 10px)"}),m.style.stylesheet+="}\n",m.style.appendRule(c+".ytwp-scrolltop #extra-buttons","display","none !important"),m.style.appendRule("ytd-app","position","static !important"),m.style.appendRule("ytd-watch #top","margin-top","71px !important"),m.style.appendRule("ytd-watch #container","margin-top","0 !important"),m.style.appendRule("ytd-watch #content-separator","margin-top","0 !important"),m.style.appendRule([c+" ytd-watch-flexy[theater] #player-wide-container.ytd-watch-flexy",c+" ytd-watch-flexy[fullscreen] #player-wide-container.ytd-watch-flexy",c+" ytd-watch-flexy[full-bleed-player] #player-full-bleed-container.ytd-watch-flexy",c+" ytd-watch-flexy[full-bleed-player] #full-bleed-container.ytd-watch-flexy",c+" ytd-watch-grid[theater] #player-wide-container.ytd-watch-grid",c+" ytd-watch-grid[fullscreen] #player-wide-container.ytd-watch-grid",c+" ytd-watch-grid[full-bleed-player] #player-full-bleed-container.ytd-watch-grid",c+" ytd-watch-grid[full-bleed-player] #full-bleed-container.ytd-watch-grid"],{position:"static",height:0,"min-height":0}),m.style.appendRule(c+".ytwp-viewing-video ytd-app #masthead-container.ytd-app",{position:"absolute",top:t,"z-index":0}),m.style.appendRule(c+".ytwp-viewing-video ytd-watch #masthead-positioner",{top:t+" !important"}),m.style.appendRule(c+" .ytp-cued-thumbnail-overlay","z-index","10"),m.style.appendRule([c+" ytd-watch-flexy[theater] #player-theater-container.ytd-watch-flexy",c+" ytd-watch-grid[theater] #player-theater-container.ytd-watch-grid"],{position:"absolute",top:"0"}),m.style.appendRule("#page-manager.ytd-app","padding-top","var(--ytd-masthead-height,var(--ytd-toolbar-height))"),m.style.appendRule(c+" #error-screen","z-index","11")},onWatchInit:function(){m.log("onWatchInit"),m.initialized&&(m.pageReady||(m.event.addBodyClass(),m.hasYoutubeChanged()&&m.debugPage(),m.pageReady=!0))},onDispose:function(){m.log("onDispose"),m.initialized=!1,m.pageReady=!1,m.isWatchPage=!1},addBodyClass:function(){document.body.classList.add(l),m.log("Applied "+y)},removeBodyClass:function(){document.body.classList.remove(l),m.log("Removed "+y)}},m.html5PlayerFix=function(){m.log("html5PlayerFix")},m.fixMasthead=function(){m.log("fixMasthead");var e=document.querySelector("#masthead-positioner-height-offset");e&&m.fixMastheadElement(e)},m.fixMastheadElement=function(e){m.log("fixMastheadElement",e),e.style.height&&setTimeout((function(){e.style.height="",document.querySelector("#appbar-guide-menu").style.marginTop=""}),0)},n.injectIntoHeader(r+"-focusfix","input#search[autofocus] { display: none; }"),m.removeSearchAutofocus=function(){var e=document.querySelector("input#search");e&&e.removeAttribute("autofocus")},m.registerMastheadFix=function(){var e,t,a,n,i;m.log("registerMastheadFix"),e="#masthead-positioner-height-offset",t={attributes:!0},a=function(e){if(console.log(e.type,e),"style"===e.attributeName){var t=e.target;t.style.height&&setTimeout((function(){t.style.height="",document.querySelector("#appbar-guide-menu").style.marginTop=""}),0)}},n=new MutationObserver((function(e){e.forEach((function(e){a(e)}))})),(i=document.querySelector(e))&&n.observe(i,t)},m.materialPageTransition=function(){m.log("materialPageTransition"),m.init(),m.isWatchUrl()?(m.removeSearchAutofocus(),m.event.addBodyClass(),m.initialized||(m.log("materialPageTransition !ytwp.html5.app",m.html5.app),setTimeout(m.materialPageTransition,100))):(m.event.onDispose(),document.body.classList.remove(l)),m.onScroll(),m.fixMasthead(),m.attemptToUpdatePlayer()},m.registerListeners=function(){m.registerMaterialListeners(),m.registerMastheadFix()},m.registerMaterialListeners=function(){document.addEventListener("yt-page-data-fetched",m.materialPageTransition),document.addEventListener("yt-navigate-finish",m.materialPageTransition),document.addEventListener("yt-page-data-fetched",(function(e){m.log("document.yt-page-data-fetched",e)})),document.addEventListener("yt-navigate-finish",(function(e){m.log("document.yt-navigate-finish",e)}))},m.main=function(){m.registerListeners(),m.init(),m.fixMasthead()},m.main(),m.updatePlayerAttempts=-1,m.updatePlayerMaxAttempts=150,m.attemptToUpdatePlayer=function(){0<=m.updatePlayerAttempts&&m.updatePlayerAttempts<m.updatePlayerMaxAttempts?m.updatePlayerAttempts=0:(m.updatePlayerAttempts=0,m.attemptToUpdatePlayerTick())},m.attemptToUpdatePlayerTick=function(){m.updatePlayerAttempts<m.updatePlayerMaxAttempts&&(m.updatePlayerAttempts+=1,m.updatePlayer(),requestAnimationFrame(m.attemptToUpdatePlayerTick))},m.updatePlayer=function(){m.removeSearchAutofocus(),m.enterTheaterMode(),m.detectPlayerUnavailable()},m.toggleExtension=function(){document.body.classList.toggle("ytwp-window-player"),m.setTheaterMode(document.body.classList.contains("ytwp-window-player"))},m.materialPageTransition(),setInterval(m.updatePlayer,2500),e.addEventListener("keydown",w.bind(null,m.toggleExtension),!0),e.addEventListener("keyup",w.bind(null,null),!0),e.addEventListener("keypress",w.bind(null,null),!0),"undefined"!=typeof browser&&browser.runtime.onMessage.addListener((e=>"toggle"==e.id?(m.toggleExtension(),Promise.resolve({enabled:document.body.classList.contains("ytwp-window-player")})):Promise.reject(new Error("Unreconized message.id"))))}function g(e){return void 0===e}function f(e,t){var a={};for(var n in e)a[e[n]]=t;return a}function w(e,t){var a="w"===t.key;(t.target===document.body||"player-api"===t.target.id||"movie_player"===t.target.id||function(e,t){for(var a=e.parentNode;a;){if(a==t)return!0;a=a.parentNode}return!1}(t.target,document.querySelector("#movie_player")))&&a&&(t.preventDefault(),t.stopPropagation(),console.log("cancelIfToggleKey.validKeyCallback",e,"e",t),e&&e())}}(window);
